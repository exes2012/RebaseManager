<Window x:Class="RebaseProjectWithTemplate.View.MainView"
        x:Name="MainViewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Rebase Project With Template"
        Height="520"
        Width="640"
        MinHeight="480"
        MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResize">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/Styles/Colors.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/TextStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/ButtonStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/ComboBoxStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/ScrollViewerStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/AnimationStyle.xaml"/>
                <ResourceDictionary Source="../Resources/Styles/ProgressSpinnerStyle.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="{StaticResource SurfaceBrush}"
            CornerRadius="{StaticResource XLargeCornerRadius}"
            Margin="16">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="8"
                            BlurRadius="24"
                            Color="{StaticResource ShadowColor}"
                            Opacity="0.15"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0"
                    Background="Transparent"
                    CornerRadius="20,20,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="72">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0"
                              Orientation="Horizontal"
                              VerticalAlignment="Center"
                              Margin="32,0">
                        <Ellipse Width="20" Height="20"
                               Fill="{StaticResource PrimaryBrush}"
                               Margin="0,0,16,0"/>
                        <TextBlock Text="Rebase Project With Template"
                                 Style="{StaticResource SubtitleStyle}"
                                 VerticalAlignment="Center"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1"
                              Orientation="Horizontal"
                              Margin="0,0,24,0">
                        <!-- Minimize Button -->
                        <Button x:Name="MinimizeButton"
                              Width="44"
                              Height="44"
                              Margin="4,0"
                              Click="MinimizeButton_Click"
                              Background="Transparent"
                              BorderThickness="0"
                              Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border"
                                          Background="{TemplateBinding Background}"
                                          CornerRadius="12">
                                        <Path x:Name="icon"
                                            Data="M 8 12 L 16 12"
                                            Stroke="{StaticResource OnSurfaceVariantBrush}"
                                            StrokeThickness="2"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource HoverBrush}"/>
                                            <Setter TargetName="icon" Property="Stroke" Value="{StaticResource OnSurfaceBrush}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource PressedBrush}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>

                        <!-- Close Button -->
                        <Button x:Name="CloseButton"
                              Width="44"
                              Height="44"
                              Margin="4,0"
                              Click="CloseButton_Click"
                              Background="Transparent"
                              BorderThickness="0"
                              Cursor="Hand">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border"
                                          Background="{TemplateBinding Background}"
                                          CornerRadius="12">
                                        <Path x:Name="icon"
                                            Data="M 8 8 L 16 16 M 16 8 L 8 16"
                                            Stroke="{StaticResource OnSurfaceVariantBrush}"
                                            StrokeThickness="2"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="{StaticResource ErrorBrush}"/>
                                            <Setter TargetName="icon" Property="Stroke" Value="White"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="border" Property="Background" Value="#FFDC2626"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="32,16,32,32">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Form Section -->
                <StackPanel Grid.Row="0">
                    <!-- Source Project -->
                    <StackPanel Margin="0,0,0,24">
                        <TextBlock Text="Source Project"
                                 Style="{StaticResource LabelStyle}"
                                 Margin="0,0,0,8"/>
                        <ComboBox ItemsSource="{Binding AllOpenDocuments}"
                                SelectedItem="{Binding SelectedSourceDocument, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                DisplayMemberPath="Title"/>
                    </StackPanel>

                    <!-- Template Project -->
                    <StackPanel Margin="0,0,0,24">
                        <TextBlock Text="Template Project"
                                 Style="{StaticResource LabelStyle}"
                                 Margin="0,0,0,8"/>
                        <ComboBox ItemsSource="{Binding AllOpenDocuments}"
                                SelectedItem="{Binding SelectedTemplateDocument, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                DisplayMemberPath="Title"/>
                    </StackPanel>
                </StackPanel>

                <!-- Progress Section -->
                <StackPanel Grid.Row="1"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"
                          Visibility="{Binding IsProgressVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Control Style="{StaticResource ProgressSpinner}"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,16"/>
                    <TextBlock Text="{Binding ProgressText}"
                             HorizontalAlignment="Center"
                             Style="{StaticResource BodyStyle}"
                             Foreground="{StaticResource OnSurfaceVariantBrush}"/>
                </StackPanel>

                <!-- Action Section -->
                <Grid Grid.Row="2">
                    <Button Content="Rebase Project"
                          Command="{Binding RebaseCommand}"
                          IsEnabled="{Binding IsRebaseButtonEnabled}"
                          HorizontalAlignment="Right"
                          MinWidth="180"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
